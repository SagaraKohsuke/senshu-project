# 月末リマインダーメール機能 - デプロイメントガイド

## 新機能概要
月末の2日前（毎月29日の午前10時）に、全ユーザーに翌月の予約を促すリマインダーメールを自動送信する機能を追加しました。

## 実装内容

### 新規追加関数

#### email.gs
- `sendMonthlyReminderEmail()`: 月末リマインダーメールを全ユーザーに送信
- `testMonthlyReminderEmail()`: リマインダーメール機能のテスト用関数

#### trigger.gs  
- `monthlyReminderManagement()`: 月末リマインダーメール送信処理
- `setReminderTrigger()`: リマインダーメール送信トリガーの設定
- `setAllTriggers()`: 全トリガーの一括設定

## デプロイメント手順

### 1. コードの更新
Google Apps Script エディタで以下のファイルの内容を更新してください：
- `email.gs`
- `trigger.gs`
- `.jshintrc` (開発環境用、省略可能)

### 2. 権限の確認
初回実行時に以下の権限が必要になります：
- Gmail 送信権限
- Google Spreadsheet アクセス権限
- タイムベーストリガー作成権限

### 3. テスト実行

#### Gmail設定確認
```javascript
checkGmailSettings()
```
これを実行して送信制限とアカウント情報を確認してください。

#### リマインダーメールテスト
```javascript  
testMonthlyReminderEmail()
```
これを実行して実際のメール送信をテストしてください。

### 4. トリガー設定

#### 個別設定
```javascript
setReminderTrigger()
```

#### 全トリガー設定（推奨）
```javascript
setAllTriggers()
```

これにより以下のトリガーが設定されます：
- 月次シート管理: 毎月1日 午前3時
- **月末リマインダー: 毎月29日 午前10時** ← 新規追加

### 5. 確認方法

#### トリガー確認
1. GAS エディタの左メニューから「トリガー」を選択
2. `monthlyReminderManagement` トリガーが「毎月29日 10:00-11:00」に設定されていることを確認

#### 実行ログ確認
1. トリガー実行後、「実行結果」から実行ログを確認
2. 成功/失敗件数とエラー詳細を確認

## メール内容
リマインダーメールには以下の内容が含まれます：
- 翌月の予約についてのお知らせ
- 個人専用の予約ページリンク
- 予約締切時間の説明
- 一括予約機能の案内

## トラブルシューティング

### よくある問題

1. **権限エラー**
   - 初回実行時は手動で関数を実行し、権限を承認してください

2. **Gmail送信制限**
   - 1日のメール送信上限は通常100通です
   - 制限に達した場合は翌日に再実行されます

3. **スプレッドシートエラー**  
   - users シートの存在確認
   - 必要な列（user_id, name, email）の確認

### ログの確認方法
```javascript
// 実行ログを確認
console.log('Manual reminder test starting...');
const result = monthlyReminderManagement();
console.log('Result:', result);
```

## 注意事項
- 毎月29日に実行されるため、30日・31日のない月でも確実に月末2日前に実行されます
- 既存の月次シート管理機能には影響しません
- メール送信に失敗した場合でもシステムは継続動作します

## メンテナンス
- トリガーの動作状況は定期的に確認してください
- 必要に応じて送信時刻やメール内容を調整できます